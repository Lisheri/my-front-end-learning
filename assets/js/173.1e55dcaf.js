(window.webpackJsonp=window.webpackJsonp||[]).push([[173],{769:function(t,s,n){"use strict";n.r(s);var a=n(5),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"patch-å‡½æ•°æ‰§è¡Œè¿‡ç¨‹"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#patch-å‡½æ•°æ‰§è¡Œè¿‡ç¨‹"}},[t._v("#")]),t._v(" patch å‡½æ•°æ‰§è¡Œè¿‡ç¨‹")]),t._v(" "),n("blockquote",[n("p",[t._v("patch å‡½æ•°åœ¨"),n("code",[t._v("createPatchFunction")]),t._v("ä¸­è¿”å›")]),t._v(" "),n("p",[t._v("é¦–å…ˆæ¥åˆ†æ patch å‡½æ•°ä¸­ä¸»è¦çš„æµç¨‹")])]),t._v(" "),n("h2",{attrs:{id:"patch-ä¸»æµç¨‹"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#patch-ä¸»æµç¨‹"}},[t._v("#")]),t._v(" patch ä¸»æµç¨‹")]),t._v(" "),n("ol",[n("li",[t._v("patch å‡½æ•°é¦–å…ˆæ¥æ”¶äº†ä¸€ä¸ª "),n("code",[t._v("oldVnode")]),t._v("å’Œä¸€ä¸ª"),n("code",[t._v("vnode")]),t._v("(æ–°çš„ vnode)")]),t._v(" "),n("li",[t._v("é¦–å…ˆåˆ¤æ–­äº†æ–°çš„"),n("code",[t._v("vnode")]),t._v("æ˜¯å¦å­˜åœ¨, å‚æ•° vnode ä¸ä¸º undefined ä¹Ÿä¸ä¸º null")])]),t._v(" "),n("ul",[n("li",[t._v("å¦‚æœ"),n("code",[t._v("vnode")]),t._v("ä¸å­˜åœ¨, åˆ™ç»§ç»­åˆ¤æ–­ oldVnode æ˜¯å¦å­˜åœ¨")]),t._v(" "),n("li",[t._v("å½“ vnode ä¸å­˜åœ¨, ä¸” oldVnode å­˜åœ¨, è¯´æ˜å½“å‰èŠ‚ç‚¹å·²ç»è¢«ç§»é™¤, æ­¤æ—¶æ— éœ€å¯¹æ¯”, ç›´æ¥è§¦å‘ olvVnode çš„ Destroy é’©å­å‡½æ•°")])]),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[t._v("å†å¾€ä¸‹å®šä¹‰äº†ä¸€ä¸ªå˜é‡ isInitialPatch å’Œä¸€ä¸ªå¸¸é‡ insertedVnodeQueue")])]),t._v(" "),n("ul",[n("li",[t._v("insertedVnodeQueue æ˜¯æ–°æ’å…¥çš„ vnode èŠ‚ç‚¹çš„é˜Ÿåˆ—, è¿™ä¸ªæ•°ç»„ç”¨äºå­˜å‚¨æ–°æ’å…¥çš„ vnode èŠ‚ç‚¹, ç›®çš„æ˜¯ä»¥åå°† vnode èŠ‚ç‚¹å¯¹åº”çš„ dom å…ƒç´ æŒ‚è½½åˆ° dom æ ‘ä¸Šå, ä¼šè§¦å‘è¿™äº›èŠ‚ç‚¹çš„ insert é’©å­å‡½æ•°")]),t._v(" "),n("li",[t._v("ä¸‹é¢çš„ invokeInsertHook, å°±æ˜¯è§¦å‘ä¸Šè¿°é˜Ÿåˆ—ä¸­ vnode èŠ‚ç‚¹çš„ insert é’©å­")]),t._v(" "),n("li",[t._v("isInitialPatch åç»­ä¼šç”¨åˆ°, åˆ°æ—¶å€™åœ¨æ¥åˆ†æå…¶ä½œç”¨")])]),t._v(" "),n("ol",{attrs:{start:"4"}},[n("li",[t._v("æ¥ä¸‹æ¥è¿›å…¥åˆ¤æ–­, é¦–å…ˆåˆ¤æ–­ oldVnode æ˜¯å¦å­˜åœ¨, ä¹Ÿå°±æ˜¯"),n("code",[t._v("oldVnode")]),t._v("æ˜¯"),n("code",[t._v("undefined")]),t._v("æˆ–"),n("code",[t._v("null")])])]),t._v(" "),n("ul",[n("li",[t._v("å½“è°ƒç”¨ç»„ä»¶çš„$mount æ–¹æ³•ä½†æ˜¯åˆæ²¡æœ‰ä¼ å…¥å‚æ•°æ—¶, æ­¤æ—¶"),n("code",[t._v("oldVnode")]),t._v("ä¸ºç©º")]),t._v(" "),n("li",[t._v("å¦‚æœ$mount ä¼ å…¥å‚æ•°å°±æ˜¯è¦æŠŠç»„ä»¶æŒ‚è½½åˆ°é¡µé¢ä¸Šçš„æŸä¸ªä½ç½®")]),t._v(" "),n("li",[t._v("å¦‚æœ$mount æ²¡æœ‰ä¼ é€’å‚æ•°, è¯´æ˜æ­¤æ—¶åªæ˜¯å°†ç»„ä»¶åˆ›å»ºå‡ºæ¥, å¹¶ä¸æŒ‚è½½åˆ°è§†å›¾ä¸Š")]),t._v(" "),n("li",[t._v("æ­¤æ—¶ä¼šå°†"),n("code",[t._v("isInitialPatch")]),t._v("å˜é‡è®¾ç½®ä¸º true, ä»–æ ‡è®°å½“å‰ VNode åˆ›å»ºå¥½äº†, å¯¹åº”çš„çœŸå® DOM ä¹Ÿåˆ›å»ºå¥½äº†, ä½†ä»…ä»…å­˜å‚¨åœ¨å†…å­˜ä¸­, è€Œä¸å°†å…¶æŒ‚è½½åˆ°é¡µé¢ä¸Š")]),t._v(" "),n("li",[t._v("æ¥ä¸‹æ¥é€šè¿‡"),n("RouterLink",{attrs:{to:"/blogs/vue-resource/virtualDOM/7.html#createelm"}},[t._v("createElm")]),t._v("(vnode, insertedVnodeQueue)å°†è¿™ä¸ª VNode è½¬æ¢ä¸ºçœŸå® DOM, ä½†æ˜¯åªæ˜¯åˆ›å»ºçœŸå® DOM, å¹¶ä¸æŒ‚è½½åˆ°é¡µé¢ä¸Š")],1),t._v(" "),n("li",[t._v("ä»ä¸‹é¢çš„"),n("code",[t._v("createElm")]),t._v("å°±å¯ä»¥çœ‹å‡ºæ¥, æœ€ç»ˆæ‰§è¡Œinsertçš„æ—¶å€™æ˜¯ç›´æ¥é€€å‡ºçš„, æ²¡æœ‰ä»»ä½•æ“ä½œ, è¯å®äº†ä¸Šé¢æ‰€è¯´çš„, åœ¨æ²¡æœ‰ä¼ å…¥oldVnodeçš„æƒ…å†µä¸‹, æ˜¯ç›´æ¥åˆ›å»ºå‡ºäº†çœŸå®DOMèŠ‚ç‚¹, ä½†åªæ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­, è€Œæ²¡æœ‰æŒ‚è½½åˆ°é¡µé¢ä¸Š")])]),t._v(" "),n("ol",{attrs:{start:"5"}},[n("li",[t._v("æ¥ä¸‹æ¥å°±æ˜¯oldVnodeå­˜åœ¨çš„æƒ…å†µ")])]),t._v(" "),n("ul",[n("li",[t._v("ä¾ç„¶è¦è¿›è¡Œä¸€ç³»åˆ—åˆ¤æ–­")]),t._v(" "),n("li",[t._v("é¦–å…ˆè·å–oldVnode.nodeTypeè¿™ä¸ªå±æ€§, åˆ¤æ–­è¿™ä¸ªå±æ€§æ˜¯å¦å­˜åœ¨\n"),n("ul",[n("li",[t._v("è¿™ä¸ª"),n("code",[t._v("nodeType")]),t._v("æ˜¯domå¯¹è±¡çš„å±æ€§, å¦‚æœå­˜åœ¨, è¯´æ˜å½“å‰oldVnodeæ˜¯ä¸€ä¸ªçœŸå®domå…ƒç´ , è€ŒoldVnodeæ˜¯ä¸€ä¸ªçœŸå®dom, è¯´æ˜æ˜¯é¦–æ¬¡æ¸²æŸ“")]),t._v(" "),n("li",[t._v("é¦–æ¬¡æ¸²æŸ“å’Œæ•°æ®æ”¹å˜åçš„å¤„ç†ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„")])])]),t._v(" "),n("li",[t._v("ç»§ç»­åšæ¡ä»¶æ§åˆ¶: å¦‚æœå½“å‰oldVnodeä¸æ˜¯ä¸€ä¸ªçœŸå®çš„domå…ƒç´ , å¹¶ä¸”oldVnodeå’Œvnodeæ˜¯ç›¸åŒçš„domå…ƒç´ , ä½¿ç”¨"),n("RouterLink",{attrs:{to:"/blogs/vue-resource/virtualDOM/7.html#samevnode"}},[t._v("sameVnode")]),t._v("(oldVnode, vnode)æ–¹æ³•åˆ¤æ–­\n"),n("ul",[n("li",[t._v("å¦‚æœoldVnodeä¸æ˜¯ä¸€ä¸ªçœŸå®èŠ‚ç‚¹, ä¸”æ–°æ—§èŠ‚ç‚¹æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹, åˆ™è§¦å‘"),n("code",[t._v("patchVnode(oldVnode, vnode, insertedVnodeQueue, null, null, removeOnly);")])]),t._v(" "),n("li",[t._v("åœ¨"),n("code",[t._v("patchVnode")]),t._v("ä¸­æ¯”è¾ƒæ–°æ—§èŠ‚ç‚¹çš„å·®å¼‚, å¹¶ä¸”å°†å·®å¼‚æ›´æ–°åˆ°çœŸå®DOMä¸Š")]),t._v(" "),n("li",[n("code",[t._v("patchVnode")]),t._v("ä¸­ä¼šæ‰§è¡Œdiffç®—æ³•, è¿™æ˜¯è¿™ä¸ªæ–¹æ³•çš„æ ¸å¿ƒ, åç»­ä¼šç»§ç»­çœ‹")])])],1),t._v(" "),n("li",[t._v("å¦‚æœoldVnodeä¸æ˜¯çœŸå®domå¹¶ä¸”oldVnodeå’Œvnodeä¸æ˜¯ç›¸åŒèŠ‚ç‚¹, æ­¤æ—¶æ‰§è¡Œelse\n"),n("ul",[n("li",[t._v("é¦–é€‰åˆ¤æ–­"),n("code",[t._v("oldVnode")]),t._v("æ˜¯ä¸€ä¸ªçœŸå®èŠ‚ç‚¹, æ»¡è¶³åˆ¤æ–­, è¯´æ˜æ˜¯é¦–æ¬¡æ¸²æŸ“\n"),n("ul",[n("li",[t._v("å‰é¢ä¸¤ä¸ªåˆ¤æ–­éƒ½æ˜¯å’ŒSSRç›¸å…³çš„å†…å®¹, è¿™é‡Œæš‚ä¸è¯´æ˜")]),t._v(" "),n("li",[t._v("æ‰€ä»¥åˆå§‹åŒ–æ¸²æŸ“æ—¶, æœ€æ ¸å¿ƒçš„å°±ä¸€å¥è¯, é‚£å°±æ˜¯å°†"),n("code",[t._v("oldValue")]),t._v("è½¬æ¢æˆä¸€ä¸ª"),n("code",[t._v("vnode")]),t._v("èŠ‚ç‚¹, åªæœ‰ä¸€å¥è¯: "),n("code",[t._v("oldVnode = emptyNodeAt(oldVnode)")]),t._v("ã€‚ä¸»è¦å°±æ˜¯è°ƒç”¨"),n("RouterLink",{attrs:{to:"/blogs/vue-resource/virtualDOM/7.html#emptynodeat"}},[t._v("emptyNodeAt")]),t._v("(oldVnode)å°†oldVnodeè½¬æ¢æˆä¸€ä¸ªVnodeèŠ‚ç‚¹")],1),t._v(" "),n("li",[t._v("é¦–æ¬¡æ¸²æŸ“æ—¶, å°†oldVnodeçš„çœŸå®domå¯¹è±¡è½¬æ¢æˆäº†ä¸€ä¸ªVNodeå¯¹è±¡å­˜å‚¨åˆ°oldVnodeä¸­, å¹¶å°†åŸæœ¬çš„çœŸå®domå­˜å‚¨åˆ°äº†VNodeçš„elmä¸­")])])]),t._v(" "),n("li",[t._v("æ¥ä¸‹æ¥ä¼šå°†"),n("code",[t._v("oldVnode.elm")]),t._v("è·å–å›æ¥, å¹¶å†²æ–°ç»™ä¸€ä¸ªå…ƒç´ å«åš"),n("code",[t._v("oldElm")]),t._v(", è·å–ä»–çš„æ ¸å¿ƒç›®çš„æ˜¯è¦å»æ‰¾è¿™ä¸ªdomå…ƒç´ çš„çˆ¶å…ƒç´ ")]),t._v(" "),n("li",[t._v("æ¥ä¸‹æ¥é€šè¿‡"),n("code",[t._v("const parentElm = nodeOps.parentNode(oldElm)")]),t._v("å»æ‰¾åˆ°ä¸Šé¢"),n("code",[t._v("oldElm")]),t._v("çš„çˆ¶å…ƒç´ \n"),n("ul",[n("li",[t._v("æ‰¾çˆ¶å…ƒç´ çš„ç›®çš„æ˜¯åé¢è¦å°†vnodeè½¬æ¢æˆçœŸå®DOM, å¹¶æŒ‚è½½åˆ°è¿™ä¸ª"),n("code",[t._v("parentElm")]),t._v("ä¸‹é¢")])])]),t._v(" "),n("li",[t._v("æ¥ä¸‹æ¥å°±è¦åšæ ¸å¿ƒäº‹æƒ…äº†, è°ƒç”¨"),n("code",[t._v("createElm")]),t._v(" "),n("ul",[n("li",[t._v("åˆšåˆšè¯´è¿‡"),n("code",[t._v("createElm")]),t._v("çš„æ ¸å¿ƒä½œç”¨å°±æ˜¯å°†VNodeè½¬æ¢æˆçœŸå®èŠ‚ç‚¹, å¹¶æŒ‚è½½åˆ°ä¼ å…¥çš„"),n("code",[t._v("parentElm")]),t._v("ä¸Š")]),t._v(" "),n("li",[t._v("å¦‚æœä¼ äº†æœ€åä¸€ä¸ªå‚æ•°, ä¹Ÿå°±æ˜¯"),n("code",[t._v("nodeOps.nextSibling(oldElm)")]),t._v(", é‚£ä¹ˆä¼šå°†VNodeæ’å…¥åˆ°è¿™äº›å…ƒç´ ä¹‹å‰, å¹¶ä¸”ä¼šå°†vnodeè®°å½•åˆ°insertedVnodeQueueè¿™ä¸ªé˜Ÿåˆ—ä¸­")]),t._v(" "),n("li",[t._v("ç¬¬ä¸‰ä¸ªå‚æ•°æœ‰ä¸€ä¸ªåˆ¤æ–­, ä»–çš„ä½œç”¨å…¶å®é€šè¿‡æ³¨é‡Šå†™å‡ºæ¥äº†, æ³¨é‡Šä¸­å‘Šè¯‰æˆ‘ä»¬, å¦‚æœå½“å‰æ­£åœ¨æ‰§è¡Œä¸€ä¸ª "),n("code",[t._v("transition")]),t._v(", å¹¶ä¸”æ‰§è¡Œçš„æ˜¯"),n("code",[t._v("leaving")]),t._v("ä»ç•Œé¢ä¸Šæ¶ˆå¤±çš„æ—¶å€™, æ­¤æ—¶ä¼šå°†"),n("code",[t._v("parentElm")]),t._v("ä¼ null, å¦‚æœ"),n("code",[t._v("parentElm")]),t._v("ä¼ null, ä¸ä¼šå°†æ–°åˆ›å»ºçš„domå…ƒç´ æŒ‚è½½åˆ°ç•Œé¢ä¸Š(å‰é¢è¯´è¿‡), è€Œæ˜¯æš‚å­˜åœ¨å†…å­˜ä¸­")])])])]),t._v(" "),n("div",{staticClass:"language-ts line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// extremely rare edge case: do not insert if old element is in a")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// leaving transition. Only happens when combining transition +")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// keep-alive + HOCs. (#4590)")]),t._v("\n  oldElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_leaveCb "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" parentElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextSibling")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * nextSibling è¿”å›oldElmçš„ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br")])]),n("ul",[n("li",[t._v("ä¸‹é¢æ˜¯å¤„ç†çˆ¶èŠ‚ç‚¹çš„å ä½ç¬¦é—®é¢˜, ä¸æ ¸å¿ƒé€»è¾‘æ— å…³, æš‚æ—¶å…ˆè·³è¿‡")]),t._v(" "),n("li",[t._v("å†å¾€ä¸‹å°±æ˜¯åˆ¤æ–­"),n("code",[t._v("parentElm")]),t._v("æ˜¯å¦å­˜åœ¨\n"),n("ul",[n("li",[t._v("è¿™ä¸ªparentElmæ˜¯ä»oldVnodeä¸­è·å–çš„")]),t._v(" "),n("li",[t._v("æ¥ä¸‹æ¥è¦åšçš„æ˜¯, å°†oldVnodeä»ç•Œé¢ä¸Šç§»é™¤, å¹¶è§¦å‘ç›¸å…³çš„é’©å­å‡½æ•°")]),t._v(" "),n("li",[t._v("ä¸»è¦é€šè¿‡"),n("RouterLink",{attrs:{to:"/blogs/vue-resource/virtualDOM/7.html#removevnodes"}},[t._v("removeVnodes")]),t._v("([oldVnode], 0, 0)æ¥å®ç°")],1)])]),t._v(" "),n("li",[t._v("å¦‚æœæ²¡æœ‰"),n("code",[t._v("parentElm")]),t._v("è¯´æ˜oldVnodeå¹¶ä¸åœ¨domæ ‘ä¸Šå­˜åœ¨, æ­¤æ—¶åˆ¤æ–­å…¶æ˜¯å¦æœ‰tagå±æ€§\n"),n("ul",[n("li",[t._v("å¦‚æœæœ‰ tagå±æ€§, åˆ™è§¦å‘destroyé’©å­å‡½æ•°")])])]),t._v(" "),n("li",[t._v("åˆ°æ­¤, ç§»é™¤è€èŠ‚ç‚¹å°±çœ‹å®Œäº†")])])]),t._v(" "),n("li",[t._v("å†å¾€ä¸‹æ˜¯è§¦å‘"),n("code",[t._v("invokeInsertHook")]),t._v(" "),n("ul",[n("li",[t._v("åœ¨è¿™ä¸ªå‡½æ•°ä¸­è§¦å‘äº†insertedVnodeQueueé˜Ÿåˆ—ä¸­æ‰€æœ‰vnodeçš„é’©å­å‡½æ•°insert")]),t._v(" "),n("li",[t._v("æœ€åè¿˜æœ‰ä¸€ä¸ªå˜é‡"),n("code",[t._v("isInitialPatch")]),t._v(", ä»–çš„ä½œç”¨æ˜¯è®°å½•å½“å‰VNodeåˆ›å»ºçš„domå…ƒç´ å¹¶æ²¡æœ‰æŒ‚è½½åˆ°é¡µé¢ä¸Š, è€Œæ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­")]),t._v(" "),n("li",[t._v("å¦‚æœå¯¹åº”çš„domå…ƒç´ , æ²¡æœ‰æŒ‚è½½åˆ°é¡µé¢ä¸Š, æ­¤æ—¶æ˜¯ä¸ä¼šè§¦å‘å¯¹åº”vnodeçš„inserté’©å­çš„, å› ä¸ºæ²¡æœ‰æŒ‚è½½")]),t._v(" "),n("li",[n("RouterLink",{attrs:{to:"/blogs/vue-resource/virtualDOM/7.html#invokeinserthook"}},[t._v("invokeInsertHook")])],1)])]),t._v(" "),n("li",[t._v("æœ€åè¿”å›æ–°çš„vnodeçš„çœŸå®domè¿”å›å¹¶è®°å½•åˆ°vm.$elä¸­")])]),t._v(" "),n("blockquote",[n("p",[t._v("åˆ°æ­¤, æ•´ä¸ªpatchçš„æ ¸å¿ƒè¿‡ç¨‹å°±ç»“æŸäº†")]),t._v(" "),n("p",[t._v("åœ¨patchå‡½æ•°å†…éƒ¨æœ‰ä¸¤ä¸ªæ ¸å¿ƒå‡½æ•°, ä¸€ä¸ªæ˜¯"),n("code",[t._v("createElm")]),t._v(", è¿˜æœ‰ä¸€ä¸ªæ˜¯"),n("code",[t._v("patchVnode")])]),t._v(" "),n("p",[t._v("åé¢ç»†ğŸ”")]),t._v(" "),n("p",[t._v("patchæºç å¤§è‡´å¦‚ä¸‹, å±è”½äº†å ä½èŠ‚ç‚¹ç›¸å…³é€»è¾‘, åŒæ ·åç»­ç»†ğŸ”")])]),t._v(" "),n("div",{staticClass:"language-ts line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createPatchFunction")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("backend"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" j\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cbs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" modules"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nodeOps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" backend\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// coreä¸­çš„createPatchFunction(backend), const { modules, nodeOps } = backend")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// coreä¸­æ–¹æ³•å’Œå¹³å°æ— å…³, ä¼ å…¥ä¸¤ä¸ªå‚æ•°å, å¯ä»¥åœ¨ä¸Šé¢çš„å‡½æ•°ä¸­ä½¿ç”¨è¿™ä¸¤ä¸ªå‚æ•°")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("patch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hydrating"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" removeOnly"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ–°çš„  VNodeä¸å­˜åœ¨")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isUndef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è€çš„ VNodeå­˜åœ¨, æ‰§è¡Œ Destroy é’©å­å‡½æ•°")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invokeDestroyHook")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" isInitialPatch "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å­˜å‚¨æ–°æ’å…¥èŠ‚ç‚¹çš„ä¸€ä¸ªé˜Ÿåˆ—")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" insertedVnodeQueue "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ¤æ–­oldVnodeæ˜¯å¦å­˜åœ¨")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isUndef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      isInitialPatch "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ›å»ºæ–°çš„ vnode")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// oldVnodeå­˜åœ¨çš„æƒ…å†µ")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ–°çš„å’Œè€çš„VNodeéƒ½å­˜åœ¨, åˆ™åšæ›´æ–°æ“ä½œ")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// isRealElement ä¸ºtrueè¡¨ç¤ºæ˜¯é¦–æ¬¡æ¸²æŸ“çš„æƒ…å†µ")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" isRealElement "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nodeType"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("isRealElement "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVnode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ›´æ–°æ“ä½œ, diffç®—æ³•")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVnode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" removeOnly"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ»¡è¶³ isRealElement, è¯´æ˜æ˜¯é¦–æ¬¡æ¸²æŸ“")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("isRealElement"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SSRç›¸å…³")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nodeType "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasAttribute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SSR_ATTR")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeAttribute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SSR_ATTR")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            hydrating "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¿˜æ˜¯SSRç›¸å…³")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isTrue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hydrating"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("hydrate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invokeInsertHook")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" oldVnode\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("warn")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'The client-side rendered virtual DOM tree is not matching '")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'server-rendered content. This is likely caused by incorrect '")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HTML markup, for example nesting block-level elements inside '")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<p>, or missing <tbody>. Bailing hydration and performing '")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'full client-side render.'")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// either not server-rendered, or hydration failed.")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// create an empty node and replace it")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * æ‰€ä»¥åˆæ¬¡æ¸²æŸ“ï¼Œç›´æ¥èµ°åˆ°è¿™é‡Œ")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å°†oldVnodeè½¬æ¢æˆå¯¹åº”çš„VNode")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åœ¨å°†åŸæœ¬çš„oldVnodeè¿™ä¸ªçœŸå®domå¯¹è±¡, æŒ‚è½½åˆ°æ–°çš„VNode.elmä¸Š")]),t._v("\n          oldVnode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("emptyNodeAt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ? å¦‚æœæ–°æ—§èŠ‚ç‚¹ä¸åŒ, é‚£å°±åˆ†æˆä¸‰ä¸ªæ­¥éª¤: â‘ åˆ›å»ºæ–°çš„èŠ‚ç‚¹ â‘¡æ›´æ–°çˆ¶çš„å ä½ç¬¦èŠ‚ç‚¹ â‘¢åˆ é™¤æ—§çš„èŠ‚ç‚¹")]),t._v("\n        \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ¥ä¸‹æ¥ä¼šå°†`oldVnode.elm`è·å–å›æ¥, å¹¶å†²æ–°ç»™ä¸€ä¸ªå…ƒç´ å«åš`oldElm`, è·å–ä»–çš„æ ¸å¿ƒç›®çš„æ˜¯è¦å»æ‰¾è¿™ä¸ªdomå…ƒç´ çš„çˆ¶å…ƒç´ ")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" oldElm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ‰¾åˆ° oldElmçš„çˆ¶å…ƒç´ ")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ‰¾çˆ¶å…ƒç´ çš„ç›®çš„æ˜¯åé¢è¦å°†vnodeè½¬æ¢æˆçœŸå®DOM, å¹¶æŒ‚è½½åˆ°è¿™ä¸ª`parentElm`ä¸‹é¢")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" parentElm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parentNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ¥ä¸‹æ¥å°±æ˜¯æ ¸å¿ƒç›®çš„ä¹‹ä¸€, åˆ›å»ºæ–°èŠ‚ç‚¹")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// create new node")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ? â‘ åˆ›å»ºæ–°çš„èŠ‚ç‚¹")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ›å»ºDOMèŠ‚ç‚¹")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n          vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// extremely rare edge case: do not insert if old element is in a")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// leaving transition. Only happens when combining transition +")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// keep-alive + HOCs. (#4590)")]),t._v("\n          oldElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_leaveCb "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" parentElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextSibling")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * nextSibling è¿”å›å…¶çˆ¶èŠ‚ç‚¹çš„ childNodes åˆ—è¡¨ä¸­ç´§è·Ÿåœ¨å…¶åé¢çš„èŠ‚ç‚¹, ä¹Ÿå°±æ˜¯ä»–çš„ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// update parent placeholder node element, recursively")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * å ä½èŠ‚ç‚¹ç›¸å…³")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * è¿™é‡Œçš„ vnode æ˜¯ä¸€ä¸ª æ¸²æŸ“vnode, ä¹Ÿå°±æ˜¯ç»„ä»¶çš„æ ¹ vnode, vnode.parent æ˜¯ä¸€ä¸ªå ä½ç¬¦èŠ‚ç‚¹")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// destroy old node é”€æ¯æ—§çš„èŠ‚ç‚¹")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ¤æ–­parentElmèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeVnodes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invokeDestroyHook")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * è¿™é‡Œå°±æ˜¯è°ƒç”¨äº†ä¸€äº›é’©å­å‡½æ•°ï¼Œä¹‹ååœ¨çœ‹")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invokeInsertHook")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" isInitialPatch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br"),n("span",{staticClass:"line-number"},[t._v("38")]),n("br"),n("span",{staticClass:"line-number"},[t._v("39")]),n("br"),n("span",{staticClass:"line-number"},[t._v("40")]),n("br"),n("span",{staticClass:"line-number"},[t._v("41")]),n("br"),n("span",{staticClass:"line-number"},[t._v("42")]),n("br"),n("span",{staticClass:"line-number"},[t._v("43")]),n("br"),n("span",{staticClass:"line-number"},[t._v("44")]),n("br"),n("span",{staticClass:"line-number"},[t._v("45")]),n("br"),n("span",{staticClass:"line-number"},[t._v("46")]),n("br"),n("span",{staticClass:"line-number"},[t._v("47")]),n("br"),n("span",{staticClass:"line-number"},[t._v("48")]),n("br"),n("span",{staticClass:"line-number"},[t._v("49")]),n("br"),n("span",{staticClass:"line-number"},[t._v("50")]),n("br"),n("span",{staticClass:"line-number"},[t._v("51")]),n("br"),n("span",{staticClass:"line-number"},[t._v("52")]),n("br"),n("span",{staticClass:"line-number"},[t._v("53")]),n("br"),n("span",{staticClass:"line-number"},[t._v("54")]),n("br"),n("span",{staticClass:"line-number"},[t._v("55")]),n("br"),n("span",{staticClass:"line-number"},[t._v("56")]),n("br"),n("span",{staticClass:"line-number"},[t._v("57")]),n("br"),n("span",{staticClass:"line-number"},[t._v("58")]),n("br"),n("span",{staticClass:"line-number"},[t._v("59")]),n("br"),n("span",{staticClass:"line-number"},[t._v("60")]),n("br"),n("span",{staticClass:"line-number"},[t._v("61")]),n("br"),n("span",{staticClass:"line-number"},[t._v("62")]),n("br"),n("span",{staticClass:"line-number"},[t._v("63")]),n("br"),n("span",{staticClass:"line-number"},[t._v("64")]),n("br"),n("span",{staticClass:"line-number"},[t._v("65")]),n("br"),n("span",{staticClass:"line-number"},[t._v("66")]),n("br"),n("span",{staticClass:"line-number"},[t._v("67")]),n("br"),n("span",{staticClass:"line-number"},[t._v("68")]),n("br"),n("span",{staticClass:"line-number"},[t._v("69")]),n("br"),n("span",{staticClass:"line-number"},[t._v("70")]),n("br"),n("span",{staticClass:"line-number"},[t._v("71")]),n("br"),n("span",{staticClass:"line-number"},[t._v("72")]),n("br"),n("span",{staticClass:"line-number"},[t._v("73")]),n("br"),n("span",{staticClass:"line-number"},[t._v("74")]),n("br"),n("span",{staticClass:"line-number"},[t._v("75")]),n("br"),n("span",{staticClass:"line-number"},[t._v("76")]),n("br"),n("span",{staticClass:"line-number"},[t._v("77")]),n("br"),n("span",{staticClass:"line-number"},[t._v("78")]),n("br"),n("span",{staticClass:"line-number"},[t._v("79")]),n("br"),n("span",{staticClass:"line-number"},[t._v("80")]),n("br"),n("span",{staticClass:"line-number"},[t._v("81")]),n("br"),n("span",{staticClass:"line-number"},[t._v("82")]),n("br"),n("span",{staticClass:"line-number"},[t._v("83")]),n("br"),n("span",{staticClass:"line-number"},[t._v("84")]),n("br"),n("span",{staticClass:"line-number"},[t._v("85")]),n("br"),n("span",{staticClass:"line-number"},[t._v("86")]),n("br"),n("span",{staticClass:"line-number"},[t._v("87")]),n("br"),n("span",{staticClass:"line-number"},[t._v("88")]),n("br"),n("span",{staticClass:"line-number"},[t._v("89")]),n("br"),n("span",{staticClass:"line-number"},[t._v("90")]),n("br"),n("span",{staticClass:"line-number"},[t._v("91")]),n("br"),n("span",{staticClass:"line-number"},[t._v("92")]),n("br"),n("span",{staticClass:"line-number"},[t._v("93")]),n("br"),n("span",{staticClass:"line-number"},[t._v("94")]),n("br"),n("span",{staticClass:"line-number"},[t._v("95")]),n("br"),n("span",{staticClass:"line-number"},[t._v("96")]),n("br"),n("span",{staticClass:"line-number"},[t._v("97")]),n("br"),n("span",{staticClass:"line-number"},[t._v("98")]),n("br"),n("span",{staticClass:"line-number"},[t._v("99")]),n("br"),n("span",{staticClass:"line-number"},[t._v("100")]),n("br"),n("span",{staticClass:"line-number"},[t._v("101")]),n("br"),n("span",{staticClass:"line-number"},[t._v("102")]),n("br"),n("span",{staticClass:"line-number"},[t._v("103")]),n("br"),n("span",{staticClass:"line-number"},[t._v("104")]),n("br"),n("span",{staticClass:"line-number"},[t._v("105")]),n("br"),n("span",{staticClass:"line-number"},[t._v("106")]),n("br")])]),n("h2",{attrs:{id:"createelm"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#createelm"}},[t._v("#")]),t._v(" createElm")]),t._v(" "),n("blockquote",[n("p",[t._v("æ­¤å¤„çš„"),n("code",[t._v("createElm")]),t._v("å¾ˆç®€ç•¥, ä¸»è¦è¯´"),n("code",[t._v("insert")]),t._v(", å…·ä½“çš„å†…å®¹è¿˜æ˜¯è¦è§"),n("RouterLink",{attrs:{to:"/blogs/vue-resource/virtualDOM/8.html"}},[t._v("VNodeçš„è½¬æ¢è¿‡ç¨‹-createElm")])],1),t._v(" "),n("p",[t._v("åœ¨createElmè¿™ä¸ªå‡½æ•°ä¸­, æ¥æ”¶äº†å¾ˆå¤šå‚æ•°, è¿™é‡Œçš„æ ¸å¿ƒå°±æ˜¯è°ƒç”¨"),n("code",[t._v("insert")]),t._v("æ–¹æ³•, å°†å½“å‰çš„vnodeæŒ‚è½½åˆ°çˆ¶èŠ‚ç‚¹ä¸‹")]),t._v(" "),n("p",[t._v("è€Œåœ¨patchå‡½æ•°ä¸­, oldVnodeä¸å­˜åœ¨æ—¶, åªä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°, é‚£å°±æ˜¯"),n("code",[t._v("vnode")]),t._v("å’Œ"),n("code",[t._v("insertedVnodeQueue")])]),t._v(" "),n("p",[t._v("ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯"),n("code",[t._v("parentElm")]),t._v(", ä¹Ÿå°±æ˜¯å°†å½“å‰Vnodeè½¬æ¢æˆçš„çœŸå®DOMæŒ‚è½½åˆ°çš„çˆ¶èŠ‚ç‚¹çš„ä½ç½®(å› ä¸ºåœ¨oldVnodeä¸å­˜åœ¨æ—¶, è¯´æ˜å½“å‰VNodeåªåˆ›å»ºä¸æŒ‚è½½, æ‰€ä»¥æ²¡æœ‰ä¼ è¿™ä¸ªå‚æ•°)")]),t._v(" "),n("ul",[n("li",[t._v("åœ¨"),n("code",[t._v("insert(parentElm, vnode.elm, refElm);")]),t._v("ä¸­ä½¿ç”¨"),n("code",[t._v("parentElm")]),t._v(", å°†åˆ›å»ºçš„ "),n("code",[t._v("vnode")]),t._v(" æŒ‚è½½åˆ° "),n("code",[t._v("parentElm")]),t._v(" ä¸­æ¥")]),t._v(" "),n("li",[t._v("ä½†æ˜¯ä¸Šé¢è¯´çš„è¿™ç§æƒ…å†µ, æ˜¯åœ¨parentElmæ²¡æœ‰ä¼ å€¼æ—¶è°ƒç”¨insert, é‡ç‚¹è¿˜æ˜¯è¦çœ‹ "),n("RouterLink",{attrs:{to:"/blogs/vue-resource/virtualDOM/7.html#insert"}},[t._v("insert")]),t._v("æ–¹æ³•çš„å®ç°")],1)])]),t._v(" "),n("div",{staticClass:"language-ts line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * createElmåªæœ‰ä¸€ä¸ªä½œç”¨ï¼Œå°±æ˜¯å°†VNodeæŒ‚è½½åˆ°çœŸå®çš„DOMä¸Š")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * ç»„ä»¶æ›´æ–°æ—¶, åˆ›å»ºæ–°çš„elmä¼ å…¥çš„å‚æ•°æ˜¯ å½“å‰vnode, ç©ºæ•°ç»„[], çˆ¶èŠ‚ç‚¹, å½“å‰èŠ‚ç‚¹æ‰€åœ¨çˆ¶äº²èŠ‚ç‚¹çš„å„¿å­èŠ‚ç‚¹æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ª")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    insertedVnodeQueue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * é™¤æ­¤æ¸²æŸ“æ—¶æ‰§è¡ŒcreateElmä¸º[]")]),t._v("\n    parentElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    refElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    nested"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    ownerArray"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    index\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* istanbul ignore if */")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__WEEX__"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * å‚æ•°ä¾æ¬¡ä»£è¡¨ çˆ¶èŠ‚ç‚¹ï¼Œ å½“å‰vnodeå¯¹åº”çš„çœŸå®DOM, å‚è€ƒèŠ‚ç‚¹")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" refElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isTrue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isComment"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" refElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" refElm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br")])]),n("h2",{attrs:{id:"insert"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#insert"}},[t._v("#")]),t._v(" insert")]),t._v(" "),n("ol",[n("li",[t._v("é¦–å…ˆåˆ¤æ–­ "),n("code",[t._v("parent")]),t._v("æ˜¯å¦æœ‰å®šä¹‰, å¦‚æœæœ‰å®šä¹‰, è¦åšçš„äº‹æƒ…å°±æ˜¯å°†DOMå…ƒç´ æŒ‚è½½åˆ°"),n("code",[t._v("parent")]),t._v("ä¸­æ¥")]),t._v(" "),n("li",[t._v("å¦‚æœæ²¡æœ‰"),n("code",[t._v("parent")]),t._v(", åˆ™ä»€ä¹ˆéƒ½ä¸æ“ä½œ")])]),t._v(" "),n("div",{staticClass:"language-ts line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ref"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * æ‰§è¡Œinserté¦–å…ˆè¦çˆ¶èŠ‚ç‚¹å­˜åœ¨")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ref"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * å¦‚æœæœ‰å‚è€ƒèŠ‚ç‚¹ï¼Œå¹¶ä¸”å‚è€ƒèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹å’Œå½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ç›¸ç­‰ï¼Œé‚£ä¹ˆå°±å°†å½“å‰èŠ‚ç‚¹æ’å…¥åˆ°å‚è€ƒèŠ‚ç‚¹å‰")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parentNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ref"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" parent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ref"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * å¦‚æœæ²¡æœ‰å‚è€ƒèŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥å°†å­èŠ‚ç‚¹æ’å…¥çˆ¶èŠ‚ç‚¹, æ¯”å¦‚è¯´éå†å„¿å­æ—¶çš„å‚è€ƒèŠ‚ç‚¹ï¼Œéƒ½æ˜¯null")]),t._v("\n      nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br")])]),n("h2",{attrs:{id:"samevnode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#samevnode"}},[t._v("#")]),t._v(" sameVnode")]),t._v(" "),n("blockquote",[n("p",[t._v("åœ¨snabbdomä¸­ä¹Ÿæœ‰sameVnodeå‡½æ•°, åœ¨å…¶ä¸­åˆ¤æ–­äº†ä¸¤ä¸ªèŠ‚ç‚¹çš„"),n("code",[t._v("key")]),t._v("æ˜¯å¦ç›¸åŒ, è¿˜åˆ¤æ–­äº†ä¸¤ä¸ªèŠ‚ç‚¹çš„"),n("code",[t._v("sel")]),t._v("ä¹Ÿå°±æ˜¯é€‰æ‹©å™¨æ˜¯å¦ç›¸åŒ, å¦‚æœä¸Šé¢çš„éƒ½ç›¸åŒ, åˆ™è®¤ä¸ºæ˜¯ç›¸åŒèŠ‚ç‚¹")]),t._v(" "),n("p",[t._v("å¦‚æœæ˜¯ç›¸åŒèŠ‚ç‚¹, æ­¤æ—¶è¦è°ƒç”¨"),n("code",[t._v("patchVnode")]),t._v("å»å¯¹æ¯”ä¸¤ä¸ªèŠ‚ç‚¹çš„å·®å¼‚")]),t._v(" "),n("p",[t._v("ä¸‹é¢æ˜¯Vueä¸­çš„"),n("code",[t._v("sameVnode")]),t._v("æ–¹æ³•")]),t._v(" "),n("p",[t._v("å…¶å®ä¸»è¦çš„æ ¸å¿ƒå°±åœ¨äºåˆ¤æ–­"),n("code",[t._v("key")]),t._v("æ˜¯å¦ç›¸åŒ, ç„¶ååˆ¤æ–­"),n("code",[t._v("tag")]),t._v("æ˜¯å¦ç›¸åŒ, "),n("code",[t._v("tag")]),t._v("ç›¸åŒåè¦ç»§ç»­åˆ¤æ–­ä»–ä»¬æ˜¯å¦åŒæ—¶éƒ½æ˜¯æ³¨é‡ŠèŠ‚ç‚¹(å› ä¸ºæ³¨é‡ŠèŠ‚ç‚¹çš„tagå¯èƒ½å’Œéæ³¨é‡ŠèŠ‚ç‚¹çš„tagä¹Ÿæ˜¯ä¸€æ ·çš„, ä½†å¹¶ä¸æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹)")]),t._v(" "),n("p",[t._v("ç„¶ååˆ¤æ–­æ˜¯å¦éƒ½æ‹¥æœ‰"),n("code",[t._v("data")]),t._v(", ä¸”ä»–ä»¬çš„inputç±»å‹æ˜¯å¦ç›¸åŒ(inputæœ‰å¾ˆå¤šç±»å‹)")]),t._v(" "),n("p",[t._v("æˆ–è€…ä»–ä»¬éƒ½æ˜¯ä¸€ä¸ªå¼‚æ­¥æ³¨é‡ŠèŠ‚ç‚¹")]),t._v(" "),n("p",[t._v("æ»¡è¶³ä¸Šè¿°æ¡ä»¶, åˆ™è¯´æ˜æ˜¯ä¸€ä¸ªç›¸åŒèŠ‚ç‚¹")])]),t._v(" "),n("div",{staticClass:"language-ts line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVnode")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * éƒ½æ²¡æœ‰å†™key, å¤§å®¶éƒ½æ˜¯ undefined ä¹Ÿæ˜¯ç›¸ç­‰çš„, è¿™æ˜¯ä¸€ä¸ªå‰ææ¡ä»¶")]),t._v("\n    a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * è¿™é‡Œç”¨äºåˆ¤æ–­æ™®é€šèŠ‚ç‚¹, å› æ­¤é¦–å…ˆåˆ¤æ–­ä»–ä»¬çš„ tag æ˜¯å¦ç›¸ç­‰")]),t._v("\n        a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n        a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isComment "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isComment "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * æ˜¯å¦åŒæ—¶æ˜¯æ³¨é‡ŠèŠ‚ç‚¹")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * æ˜¯å¦åŒæ—¶å®šä¹‰äº†data")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameInputType")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * æ˜¯å¦æ˜¯ä¸€ä¸ªç›¸åŒçš„inputç±»å‹")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * isAsyncPlaceholder è¡¨ç¤ºæ˜¯å¼‚æ­¥å ä½ç¬¦èŠ‚ç‚¹")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isTrue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isAsyncPlaceholder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n        a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asyncFactory "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asyncFactory "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isUndef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asyncFactory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * è¡¨ç¤ºæ˜¯ä¸€ä¸ªæ­£ç¡®çš„å¼‚æ­¥æ³¨é‡ŠèŠ‚ç‚¹")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br")])]),n("h2",{attrs:{id:"emptynodeat"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#emptynodeat"}},[t._v("#")]),t._v(" emptyNodeAt")]),t._v(" "),n("blockquote",[n("p",[t._v("è¿™ä¸ªå‡½æ•°ä¸­, åªæœ‰ä¸€å¥è¯, è¿”å›äº†ä¸€ä¸ªVNodeå¯¹è±¡")]),t._v(" "),n("p",[t._v("ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åœ¨è·å–vnodeå¯¹åº”æ ‡ç­¾çš„åç§°")]),t._v(" "),n("p",[t._v("åé¢å‡ ä¸ªå‚æ•°éƒ½æ²¡æœ‰ä¼ å€¼, æœ€åä¸€ä¸ªå‚æ•°è¡¨ç¤ºelmå¯¹è±¡, ä¹Ÿå°±æ˜¯å½“å‰çš„domå…ƒç´ , ä¼šå°†å½“å‰çš„domå…ƒç´ è®°å½•åˆ°å½“å‰"),n("code",[t._v("vnode.elm")]),t._v("ä¸Š(æ„é€ å™¨ä¸­æ‰§è¡Œ: "),n("code",[t._v("this.elm = elm")]),t._v(")")])]),t._v(" "),n("div",{staticClass:"language-ts line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("emptyNodeAt")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„VNodeï¼Œtagå°±æ˜¯ä»¥å‰çš„nodeä¹Ÿå°±æ˜¯çœŸå®DOMçš„tagï¼Œç„¶ådataå’Œchildrenéƒ½æ˜¯ç©ºå€¼ï¼Œæ–‡æœ¬ä¸ºundefinedï¼Œå¯¹åº”çš„çœŸå®DOMå°±æ˜¯è¯¥çœŸå®DOM")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * è¯´ç™½äº†å°±æ˜¯å°†ä¸€ä¸ªçœŸå®DOMè½¬æ¢ä¸ºVirtual DOM")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("VNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tagName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toLowerCase")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])]),n("h2",{attrs:{id:"removevnodes"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#removevnodes"}},[t._v("#")]),t._v(" removeVnodes")]),t._v(" "),n("blockquote",[n("p",[t._v("åœ¨removeVnodesä¸­, éå†vnodes, ä¹Ÿå°±æ˜¯oldVnodes")]),t._v(" "),n("p",[t._v("æ‰¾åˆ°æ¯ä¸€ä¸ªvnode, åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨")]),t._v(" "),n("p",[t._v("å¦‚æœèŠ‚ç‚¹å­˜åœ¨å¹¶ä¸”æœ‰tagå±æ€§, è¯´æ˜ä»–æ˜¯ä¸€ä¸ªtagæ ‡ç­¾")]),t._v(" "),n("p",[t._v("å¹¶ä¸”å°†è¿™ä¸ªtagä»domä¸Šç§»é™¤å¹¶è§¦å‘å¯¹åº”çš„removeé’©å­å‡½æ•°"),n("code",[t._v("removeAndInvokeRemoveHook(ch)")])]),t._v(" "),n("p",[t._v("æ¥ç€è§¦å‘vnodeçš„destroyé’©å­å‡½æ•°"),n("code",[t._v("invokeDestroyHook(ch)")])]),t._v(" "),n("p",[t._v("å¦‚æœæ²¡æœ‰tagæ ‡ç­¾, è¯´æ˜æ˜¯ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹, æ­¤æ—¶ç›´æ¥æŠŠæ–‡æœ¬èŠ‚ç‚¹ä»domæ ‘ä¸Šç§»é™¤"),n("code",[t._v("removeNode(ch.elm)")])])]),t._v(" "),n("div",{staticClass:"language-ts line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeVnodes")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnodes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" startIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" endIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" startIdx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" endIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("startIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ch "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vnodes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("startIdx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeAndInvokeRemoveHook")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invokeDestroyHook")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Text node")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeNode")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ‰¾åˆ°domæ ‘ä¸Šçš„çˆ¶èŠ‚ç‚¹")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" parent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parentNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// element may have already been removed due to v-html / v-text")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ¤æ–­æ˜¯å¦å­˜åœ¨çˆ¶èŠ‚ç‚¹")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœå­˜åœ¨çˆ¶èŠ‚ç‚¹, åˆ™è°ƒç”¨domæ–¹æ³•removeChildç§»é™¤çˆ¶èŠ‚ç‚¹ä¸‹çš„å½“å‰èŠ‚ç‚¹å³å¯")]),t._v("\n    nodeOps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeChild")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" el"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br")])]),n("h2",{attrs:{id:"invokeinserthook"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#invokeinserthook"}},[t._v("#")]),t._v(" invokeInsertHook")]),t._v(" "),n("blockquote",[n("p",[t._v("å¦‚æœ"),n("code",[t._v("initial")]),t._v("æ˜¯true, å¹¶ä¸”vnodeæœ‰parentå±æ€§, æ­¤æ—¶å¹¶ä¸ä¼šè§¦å‘å¯¹åº”vnodeçš„é’©å­å‡½æ•°inserté’©å­")]),t._v(" "),n("p",[t._v("è€Œæ˜¯æ ‡è®°å½“å‰çš„æ’å…¥æ˜¯ä¸€ä¸ªpending(å»¶è¿Ÿæ’å…¥), å°†å½“å‰é˜Ÿåˆ—è®°å½•åˆ°"),n("code",[t._v("vnode.parent.data.pendingInsert")]),t._v("é˜Ÿåˆ—ä¸­")]),t._v(" "),n("p",[t._v("å°†æ¥å½“è¿™ä¸ªdomå…ƒç´ çœŸçš„æ’å…¥åˆ°é¡µé¢ä¸­ä¹‹å, æ‰ä¼šè§¦å‘è¿™ä¸ªpendingInserté˜Ÿåˆ—ä¸­æ¯ä¸ªvnodeçš„inserté’©å­å‡½æ•°")]),t._v(" "),n("p",[t._v("å¦‚æœ"),n("code",[t._v("initial")]),t._v("ä¸æ˜¯true, è¯´æ˜éœ€è¦æ‰§è¡Œæ’å…¥, ç›´æ¥éå†é˜Ÿåˆ—, æ‰§è¡Œ"),n("code",[t._v("queue[i].data.hook.insert(queue[i])")]),t._v("æ–¹æ³•è§¦å‘æ¯ä¸€ä¸ªvnodeçš„inserté’©å­å‡½æ•°")])]),t._v(" "),n("div",{staticClass:"language-ts line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invokeInsertHook")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" initial"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// delay insert hooks for component root nodes, invoke them after the")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// element is really inserted")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isTrue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("initial"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pendingInsert "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queue\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hook"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br")])]),n("h2",{attrs:{id:"invokedestroyhook"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#invokedestroyhook"}},[t._v("#")]),t._v(" invokeDestroyHook")]),t._v(" "),n("blockquote",[n("p",[t._v("ä¸»è¦çœ‹vnode.dataæ˜¯å¦å®šä¹‰, ä¸”vnode.dataä¸­æ˜¯å¦åŒ…å«hookå±æ€§ä»¥åŠhookå±æ€§ä¸­æ˜¯å¦å­˜åœ¨destroyå±æ€§, å¦‚æœå­˜åœ¨, åˆ™ç›´æ¥æ‰§è¡Œdestroyé’©å­")]),t._v(" "),n("p",[t._v("éå†cbs.destroy, æ‰§è¡Œvnodeå„ä¸ªé˜¶æ®µçš„destroyé’©å­")]),t._v(" "),n("p",[t._v("å¦‚æœvnode.childrenå­˜åœ¨, åˆ™é€’å½’æ‰§è¡Œå„¿å­èŠ‚ç‚¹çš„é”€æ¯å·¥ä½œ")]),t._v(" "),n("p",[t._v("ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºæ¥, ç»„ä»¶é”€æ¯æ˜¯"),n("code",[t._v("å…ˆçˆ¹åå„¿")]),t._v("çš„")])]),t._v(" "),n("div",{staticClass:"language-ts line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invokeDestroyHook")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œé€’å½’çš„å»é”€æ¯å­ç»„ä»¶")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * ä¸åœçš„æ‰§è¡Œé”€æ¯å·¥ä½œ")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" j\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" data "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hook"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("destroy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("i")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * è¿™ä¸ªcbsåŒ…å«äº†ç»„ä»¶çš„æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°(åˆå¹¶è¿‡åçš„)")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * ä»è¿™é‡Œå¼€å§‹æ‰§è¡Œé”€æ¯å·¥ä½œï¼Œä¸€å±‚ä¸€å±‚åˆ°æœ€åº•ä¸‹çš„é”€æ¯å·¥ä½œå®Œæˆäº†ï¼Œæ‰ä¼šé€€å‡ºé€’å½’")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * å› æ­¤ï¼Œæœ€åº•å±‚çš„destroyæœ€å…ˆå®Œæˆï¼Œé€€å‡ºé€’å½’")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// * æ‰€ä»¥ä½¿ç”¨destroyedè¿™ä¸ªé’©å­å‡½æ•°çš„æ—¶å€™ï¼Œå„¿å­æ¯”çˆ¹å…ˆæ‰§è¡Œã€‚è¶Šé¡¶å±‚è¶Šåæ‰§è¡Œé”€æ¯é’©å­(å¹¶ä¸æ˜¯åæ‰§è¡Œé”€æ¯ï¼Œä»…ä»…åªæ˜¯åæ‰§è¡Œé”€æ¯é’©å­ï¼Œç„¶åæœ€åæ¸…ç©ºï¼Œé”€æ¯å¼€å§‹è¿˜æ˜¯å¾ˆæ—©çš„)")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" cbs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("destroy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" cbs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("destroy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("j "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" j "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("j"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invokeDestroyHook")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("j"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);