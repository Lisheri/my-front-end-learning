(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{606:function(s,n,a){"use strict";a.r(n);var e=a(5),l=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"构建速度优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建速度优化"}},[s._v("#")]),s._v(" 构建速度优化")]),s._v(" "),a("h2",{attrs:{id:"speed-measure-webpack-plugin-插件打出插件和加载器的构建耗时"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#speed-measure-webpack-plugin-插件打出插件和加载器的构建耗时"}},[s._v("#")]),s._v(" speed-measure-webpack-plugin 插件打出插件和加载器的构建耗时")]),s._v(" "),a("p",[s._v("本人当前目标优化项目二次耗时如下：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" SMP  ⏱  \nGeneral output time took 10 mins, 41.93 secs\n\n SMP  ⏱  Plugins\nIgnorePlugin took 1 min, 46.021 secs\nTerserPlugin took 1 min, 19.61 secs\nOptimizeCssAssetsWebpackPlugin took 24.63 secs\nMiniCssExtractPlugin took 13.49 secs\nManifestPlugin took 1.29 secs\nInlineChunkHtmlPlugin took 0.732 secs\nInterpolateHtmlPlugin took 0.66 secs\nDefinePlugin took 0.648 secs\nModuleNotFoundPlugin took 0.443 secs\nHtmlWebpackPlugin took 0.039 secs\n\n SMP  ⏱  Loaders\ncache-loader, and \nbabel-loader took 3 mins, 54.72 secs\n  module count = 2444\nmini-css-extract-plugin, and \ncache-loader, and \ncss-loader, and \npostcss-loader, and \nless-loader took 3 mins, 48.24 secs\n  module count = 582\nthread-loader, and \nbabel-loader took 3 mins, 47.034 secs\n  module count = 2147\ncache-loader, and \ncss-loader, and \npostcss-loader, and \nless-loader took 3 mins, 20.12 secs\n  module count = 582\nthread-loader, and \nstyle-loader, and \nmini-css-extract-plugin, and \ncache-loader, and \ncss-loader, and \npostcss-loader, and \nless-loader took 2 mins, 28.16 secs\n  module count = 582\nurl-loader took 37.36 secs\n  module count = 132\nmini-css-extract-plugin, and \ncache-loader, and \ncss-loader, and \npostcss-loader took 9.34 secs\n  module count = 9\ncache-loader, and \ncss-loader, and \npostcss-loader took 5.11 secs\n  module count = 9\nmodules with no loaders took 4.74 secs\n  module count = 54\nthread-loader, and \nstyle-loader, and \nmini-css-extract-plugin, and \ncache-loader, and \ncss-loader, and \npostcss-loader took 2.8 secs\n  module count = 9\ncss-loader, and \npostcss-loader took 2.2 secs\n  module count = 6\nfile-loader took 0.834 secs\n  module count = 4\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br")])]),a("h2",{attrs:{id:"优化方向"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化方向"}},[s._v("#")]),s._v(" 优化方向")]),s._v(" "),a("ul",[a("li",[s._v("babel-loader耗时过长, 需要优化")]),s._v(" "),a("li",[s._v("\b代码压缩耗时过长")]),s._v(" "),a("li",[s._v("忽略文件耗时过长")]),s._v(" "),a("li",[s._v("生成.map文件耗时过长")]),s._v(" "),a("li",[s._v("初始化打包时生成缓存文件耗时过长")]),s._v(" "),a("li",[s._v("additional chunk assets processing阶段耗时过长(涉及到内存分配问题)")]),s._v(" "),a("li",[s._v("各类loader, plugin版本过低, 不匹配webpack4.x, 导致速度过慢")])]),s._v(" "),a("h2",{attrs:{id:"初次优化后的首次打包时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初次优化后的首次打包时间"}},[s._v("#")]),s._v(" 初次优化后的首次打包时间")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" SMP  ⏱  \nGeneral output time took 8 mins, 28.92 secs\n\n SMP  ⏱  Plugins\nTerserPlugin took 4 mins, 34.29 secs\nOptimizeCssAssetsWebpackPlugin took 26.64 secs\nWebpackBarPlugin took 15.019 secs\nManifestPlugin took 5.68 secs\nMiniCssExtractPlugin took 1.13 secs\nGenerateSW took 0.726 secs\nInlineChunkHtmlPlugin took 0.38 secs\nModuleNotFoundPlugin took 0.318 secs\nDefinePlugin took 0.304 secs\nInterpolateHtmlPlugin took 0.301 secs\nContextReplacementPlugin took 0.295 secs\nHtmlWebpackPlugin took 0.186 secs\n\n SMP  ⏱  Loaders\nmini-css-extract-plugin, and \ncss-loader, and \npostcss-loader, and \nless-loader took 2 mins, 50.5 secs\n  module count = 582\ncss-loader, and \npostcss-loader, and \nless-loader took 2 mins, 50.47 secs\n  module count = 582\nthread-loader, and \ncache-loader, and \nbabel-loader took 2 mins, 35.6 secs\n  module count = 2147\nmodules with no loaders took 1 min, 37.23 secs\n  module count = 3074\nthread-loader, and \ncache-loader, and \nstyle-loader, and \nmini-css-extract-plugin, and \ncss-loader, and \npostcss-loader, and \nless-loader took 1 min, 7.77 secs\n  module count = 582\nmini-css-extract-plugin, and \ncss-loader, and \npostcss-loader took 18.29 secs\n  module count = 2\nurl-loader took 17.009 secs\n  module count = 132\ncss-loader, and \npostcss-loader took 16.23 secs\n  module count = 2\nfile-loader took 2.66 secs\n  module count = 11\nthread-loader, and \ncache-loader, and \nstyle-loader, and \nmini-css-extract-plugin, and \ncss-loader, and \npostcss-loader took 0.155 secs\n  module count = 2\nhtml-webpack-plugin took 0.028 secs\n  module count = 1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br")])]),a("h2",{attrs:{id:"优化方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化方法"}},[s._v("#")]),s._v(" 优化方法")]),s._v(" "),a("ul",[a("li",[s._v("babel-loader 查询范围缩小, 拒绝查询node_modules, 当然, 要除去其中有一个需要打包的文件, 这里采用的include")]),s._v(" "),a("li",[s._v("TerserPlugin js代码压缩, 同样 exclude掉 "),a("code",[s._v("node_modules")])]),s._v(" "),a("li",[s._v("取消使用IgnorePlugin忽略moment.js, 换为"),a("code",[s._v("new MomentLocalesPlugin()")]),s._v("这个插件, 忽略掉除en以外的所有语言环境")]),s._v(" "),a("li",[s._v("取消所有的cache-loader, 换效率更高的 "),a("code",[s._v("HardSourceWebpackPlugin")]),s._v(", 让二次打包下降到1min左右")]),s._v(" "),a("li",[s._v("devtool使用cheap-source-map")]),s._v(" "),a("li",[s._v("thread-loader下的线程池中并行的子线程数增大")]),s._v(" "),a("li",[s._v("optimization下加强 "),a("code",[s._v("tree-shaking")]),s._v(", 打开生产环境下的 "),a("code",[s._v("usedExports")]),s._v(', 用于标记需要摇掉的"树叶"')]),s._v(" "),a("li",[s._v("optimization下开启 Scope Hoisting, 也就是在生产环境下打开 "),a("code",[s._v("concatenateModules")])]),s._v(" "),a("li",[s._v("升级loader和plugin")])]),s._v(" "),a("h2",{attrs:{id:"更进一步的提速"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更进一步的提速"}},[s._v("#")]),s._v(" 更进一步的提速")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("升级到webpack5.x")])]),s._v(" "),a("li",[a("p",[s._v("处理 "),a("code",[s._v("MiniCssExtractPlugin.loader")]),s._v(" 后不调用style-loader报错的问题, 按理来说使用了"),a("code",[s._v("MiniCssExtractPlugin.loader")]),s._v(", 就不再需要style-loader了(使用了link, 也就不需要style标签植入了), 但是这里取消了style-loader会报错。")])]),s._v(" "),a("li",[a("p",[s._v("new HardSourceWebpackPlugin.ParallelModulePlugin, 处理这个实验性质的模块导致的中断问题, 多线程环境下增加首次打包时生成缓存文件的速度。")])]),s._v(" "),a("li",[a("p",[s._v("splitChunks拆分文件没有遵守minSize这个规则, 可能是其他地方影响了")])])])])}),[],!1,null,null,null);n.default=l.exports}}]);