---
title: rollup学习
date: 2021-05-18
tags:
 - 模块化
 - rollup
categories: 
 - 前端工程化
---

# 快速上手

## rollup简介

Rollup同样也是一款ES Module的打包器, 也可以将项目中散落的细小模块打包成整块的代码, 从而使这些划分的模块可以更好的运行子啊浏览器环境或者nodejs环境。

他和webpack很像, 不过相比于webpack, `rollup要小巧的多` 

webpack可以满足前端工程化几乎所有的打包需求

而rollup, 仅仅是一款ESM打包器, 并没有其他额外的功能

比如webpack中有HMR模块热替换功能, 而Rollup中并不支持 类似HMR这种高级特性

当然, rollup诞生的目的并不是和webpack竞争， 他的初衷只是`提供一个充分利用ESM各项特性的高效打包器`

构建出结构扁平, 性能优秀的类库

## 上手

有一个示例, 准备了三个文件, 其中一个默认导出了一个对象, 另外一个默认导出了两个打印函数, 一个打印错误, 一个打印正确的信息

然后通过一个index.js, 分别引入打印正确的那个函数, 以及哪一个默认对象, 然后使用对象模块下的内容, 使用打印正确的函数打印内容

如下：

```javaScript
// logger.js
export const log = msg => {
    console.info('----------INFO----------');
    console.info(msg);
    console.info('------------------------');
}

export const error = msg => {
    console.error('----------ERROR----------');
    console.error(msg);
    console.error('-------------------------');
}

// message.js
export default {
    hi: 'hey guys, I am mhe'
}

// index.js
import { log } from './logger';
import messages from './messages';

// 使用模块成员
const msg = messages.hi;

log(msg);
```

然后使用一下rollup, 安装完成后直接使用, 就会抛出一个正确的使用方式`Usage: rollup [options] <entry file>`

应该用参数去控制需要打包的模块

因此应该这样: `yarn rollup ./src/index.js`

但是这样打不出任何东西, 同时我们还应该指定输出格式, 如此`yarn rollup ./src/index.js --format iife`

这里选择的是iife格式, 也就是自调用函数, 以往的版本, 不指定会报错, 但是现在的版本不会(2.48.0)

通过指定`--file dist/bundle.js`, 那么rollup就会将打包结果输出到文件中

打开bundle.js一看, 就会发现, rollup的打包结果, 惊人的简介, 几乎和手写的代码是一样的, 相比于webpack中一堆辅助函数和引导定义的模块变量, 这里的打包结果, 几乎没有任何多余的代码, 就是按照打包顺序, 将用到的模块, 一个一个拼接到一个文件中而已

而且他, 只打包了用到的部分, 自动开启了`tree-shaking`去优化打包结果, 并且`tree-shaking`这个概念, 最早就是在rollup中提出的

```javaScript
// bundle.js
(function () {
    'use strict';

    const log = msg => {
        console.info('----------INFO----------');
        console.info(msg);
        console.info('------------------------');
    };

    var messages = {
        hi: 'hey guys, I am mhe'
    };

    // 使用模块成员
    const msg = messages.hi;

    log(msg);

}());
```

## rollup配置文件












